<apex:page controller="n2de.Settings_ExportImport_Controller" tabStyle="Settings__tab" sidebar="false" standardStylesheets="false" docType="html-5.0" title="Distribution Engine: Export/Import" action="{!init}">
    <html>

    <head>
        <c:PageHead />

        <script defer="defer">
                window.addEventListener('load', function() {
                    <c:ApplicationContext attrOrgNamespace="{!JSENCODE(OrgNamespace)}" attrIsSandbox="{!IsSandbox}" attrIsDeveloperOrg="{!IsDeveloperOrg}" attrIsTrialOrg="{!IsTrialOrg}"/>
                    <c:PageContext />

                    const getMigrationContentTypes = new n2.dataProvider.Static({
                        id: 'get-migration-content-types',
                        data: ['Tag collection', 'Team']
                    });

                    const getMigrations = new n2.dataProvider.VisualForce({
                        id: 'get-migrations',
                        methods: {
                            get: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.getMigrations}'
                            }
                        }
                    });

                    const getObjectsAvailableForMigration = new n2.dataProvider.VisualForce({
                        id: 'get-objects-available-for-migration',
                        methods: {
                            get: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.getObjectsAvailableForMigration}'
                            }
                        }
                    });

                    const startExport = new n2.dataProvider.VisualForce({
                        id: 'start-export',
                        methods: {
                            post: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.startExport}'
                            }
                        }
                    });

                    const deleteImportExport = new n2.dataProvider.VisualForce({
                        id: 'delete-import-export',
                        methods: {
                            post: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.deleteImportExport}'
                            }
                        }
                    });

                    const validateImport = new n2.dataProvider.VisualForce({
                        id: 'validate-import',
                        methods: {
                            get: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.validateImport}'
                            }
                        }
                    });
                    // This helps avoid us showing the error message at the page level if the data provider fails.
                    // @see N2JS-324 - once fixed we can amend this to use the new approach
                    n2.DataProviderManager.getInstance().get('validate-import').removeListeners('error');

                    const startImport = new n2.dataProvider.VisualForce({
                        id: 'start-import',
                        methods: {
                            post: {
                                method: '{!$RemoteAction.Settings_ExportImport_Controller.startImport}'
                            }
                        }
                    });

                    const settingsExportImportPage = new n2.de.page.settings.ExportImport({
                        id: 'setting-export-import-page',
                        downloadUrl: '{!DownloadUrl}'
                    });
                    settingsExportImportPage.render();
                });
            </script>
    </head>

    <body></body>

    </html>
</apex:page>