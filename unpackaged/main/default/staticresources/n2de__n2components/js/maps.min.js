/*Copyright: © 2020 NC Squared Ltd, All Rights Reserved*/
var t,n;ncsquared.maps.Breadcrumb={updatePanel:function(){var n=n2.maps.Context.breadcrumb.length-1;n2.util.each(n2.maps.Context.breadcrumb,function(t,e){e.index=t,e.last=t===n});var t=n2.ui.renderTemplate(n2.maps.HTML.HTML_BREADCRUMB,n2.maps.Context.breadcrumb);n2j$(n2.maps.Context.config.breadcrumb).html(t)},getCurrentItem:function(){return n2.maps.Context.breadcrumb[n2.maps.Context.breadcrumb.length-1]},length:function(){return n2.maps.Context.breadcrumb.length},loadFromBreadcrumb:function(t){n2.maps.Context.breadcrumb=n2.maps.Context.breadcrumb.slice(0,Number(t)+1),n2.maps.Features.loadGeoJsonData()},reset:function(){n2.maps.Context.breadcrumb=n2.maps.Context.breadcrumb.slice(0,1)},addItem:function(t,e){var n,s=n2.maps.Breadcrumb.getCurrentItem();n=n2.maps.Constants.ZOOM_TYPE_COUNTRY===s.type?n2.maps.Context.mappingData.countryNames[t]||t:n2.maps.Constants.ZOOM_TYPE_STATE===s.type&&n2.maps.Context.mappingData.stateNames[t]||t,n2.maps.Context.breadcrumb.push({name:n,id:t,type:e,typeDescription:n2.maps.Constants.ZOOM_TYPE_DESCRIPTIONS[e],country:s.country||t,parentType:s.type,stateParent:s.stateParent||s.type===n2.maps.Constants.ZOOM_TYPE_STATE})}},ncsquared.maps.Constants={},n2.maps.Constants.GEOJSON_URL="/geojson/",n2.maps.Constants.COMBINE_URL="/maps/v1/combine",n2.maps.Constants.ZOOM_TYPE_COUNTRY="C",n2.maps.Constants.ZOOM_TYPE_STATE="S",n2.maps.Constants.ZOOM_TYPE_POSTAL="P",n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL="P2",n2.maps.Constants.ZOOM_TYPE_PHONE="T",n2.maps.Constants.ZOOM_TYPES=[n2.maps.Constants.ZOOM_TYPE_COUNTRY,n2.maps.Constants.ZOOM_TYPE_STATE,n2.maps.Constants.ZOOM_TYPE_POSTAL,n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL,n2.maps.Constants.ZOOM_TYPE_PHONE],n2.maps.Constants.ZOOM_TYPE_DESCRIPTIONS=((t={})[n2.maps.Constants.ZOOM_TYPE_COUNTRY]="Country",t[n2.maps.Constants.ZOOM_TYPE_STATE]="State/Province",t[n2.maps.Constants.ZOOM_TYPE_POSTAL]="Zip/Postal Summary",t[n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL]="Zip/Postal",t[n2.maps.Constants.ZOOM_TYPE_PHONE]="Phone",t),n2.maps.Constants.ZOOM_COUNTRIES={AUS:{children:[{type:n2.maps.Constants.ZOOM_TYPE_STATE,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]}]}]},CAN:{children:[{type:n2.maps.Constants.ZOOM_TYPE_STATE,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]}]},DEU:{children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]}]},FRA:{children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]}]},GBR:{children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]},{type:n2.maps.Constants.ZOOM_TYPE_STATE}]},USA:{children:[{type:n2.maps.Constants.ZOOM_TYPE_STATE,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL,children:[{type:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL}]}]}]}},n2.maps.Constants.ZOOM_COUNTRIES_TYPES=(n={},n2.util.each(n2.maps.Constants.ZOOM_COUNTRIES,function(t,e){var s=[];n[t]=s,n2.util.eachDeep(e,function(t,e,n){"type"===e&&s.push(n)})}),n),n2.maps.Constants.DEFAULT_BOUNDS={north:67,south:-35,east:147,west:-132},n2.maps.Constants.COUNTRY_BOUNDS={USA:{north:49.85,south:23.9,east:-58.59,west:-129.56},CAN:{north:70.99,south:47.94,east:-55.08,west:-140.33}},n2.maps.Constants.STYLE_DEFAULT={strokeColor:"#808080",strokeWeight:1,strokeOpacity:.6,fillOpacity:.1},n2.maps.Constants.STYLE_HOVER={strokeWeight:4},n2.maps.Constants.STYLE_ZOOMABLE={strokeColor:"#4BC076",strokeWeight:2,strokeOpacity:1},n2.maps.Constants.STYLE_SELECTED={fillColor:"#0000FF",fillOpacity:.5},n2.maps.Constants.STYLE_SELECTED_OTHER={fillColor:"#000000",fillOpacity:.5,clickable:!1},n2.maps.Constants.TERRITORY_COLORS=[{name:"Beetroot",color:"#AD1457"},{name:"Cherry Blossom",color:"#D81B60"},{name:"Tomato",color:"#D50000"},{name:"Flamingo",color:"#E67C73"},{name:"Tangerine",color:"#F4511E"},{name:"Pumpkin",color:"#EF6C00"},{name:"Mango",color:"#F09300"},{name:"Banana",color:"#F6BF26"},{name:"Citron",color:"#E4C441"},{name:"Avocado",color:"#C0CA33"},{name:"Pistachio",color:"#7CB342"},{name:"Sage",color:"#33B679"},{name:"Basil",color:"#0B8043"},{name:"Eucalyptus",color:"#009688"},{name:"Peacock",color:"#039BE5"},{name:"Cobalt",color:"#4285F4"},{name:"Blueberry",color:"#3F51B5"},{name:"Lavender",color:"#7986CB"},{name:"Wisteria",color:"#B39DDB"},{name:"Amethyst",color:"#9E69AF"},{name:"Grape",color:"#8E24AA"},{name:"Cocoa",color:"#795548"},{name:"Graphite",color:"#616161"},{name:"Birch",color:"#A79B8E"}],n2.maps.Constants.CLICK_DELAY=300,n2.maps.Constants.MAX_TERRITORIES_FOR_SUMMARY=500,n2.maps.Constants.REGEX_A=/[ãâäàåáÀÁÂÃÄÅ]/g,n2.maps.Constants.REGEX_E=/[éèêëÈÉÊË]/g,n2.maps.Constants.REGEX_I=/[ïîìíÌÍÎÏ]/g,n2.maps.Constants.REGEX_O=/[ôöòõóÒÓÔÕÖ]/g,n2.maps.Constants.REGEX_U=/[ûùúüÙÚÛÜ]/g,n2.maps.Constants.REGEX_C=/[çÇ]/g,n2.maps.Constants.REGEX_N=/[ñÑ]/g,n2.maps.Constants.REGEX_AND=/&/g,n2.maps.Constants.REGEX_SPACE=/-/g,n2.maps.Constants.REGEX_OTHER=/[^a-zA-Z\d\s]/g,n2.maps.Constants.REGEX_MULTIPLE_SPACES=/\s+/g,n2.maps.Constants.REGEX_USA_ZIP=/^(\d{3}|\d{5})$/,n2.maps.Constants.REGEX_USA_ZIP_SUMMARY=/^\d{3}$/,n2.maps.Constants.REGEX_CAN_POSTAL=/^[a-zA-Z]\d[a-zA-Z]$/,n2.maps.Constants.REGEX_GBR_POSTAL=/^[a-zA-Z][a-hA-Hj-yJ-Y]?(\d[a-zA-Z\d]?)?$/,n2.maps.Constants.REGEX_GBR_POSTAL_SUMMARY=/^[a-zA-Z][a-hA-Hj-yJ-Y]?$/,n2.maps.Constants.REGEX_FRA_POSTAL=/^(\d{2}|2[abAB]|\d{5})$/,n2.maps.Constants.REGEX_FRA_POSTAL_SUMMARY=/^(\d{2}|2[abAB])$/,n2.maps.Constants.REGEX_DEU_POSTAL=/^(\d{2}|\d{5})$/,n2.maps.Constants.REGEX_DEU_POSTAL_SUMMARY=/^(\d{2})$/,n2.maps.Constants.REGEX_AUS_NZL_POSTAL=/^(\d{2}|\d{4})$/,n2.maps.Constants.REGEX_AUS_NZL_POSTAL_SUMMARY=/^(\d{2})$/,n2.maps.Constants.IMPORT_TYPE_AUTODETECT="-",n2.maps.Constants.IMPORT_STATE_COUNTRIES=["USA","CAN","AUS","GBR"],n2.maps.Constants.IMPORT_POSTAL={USA:{regex:n2.maps.Constants.REGEX_USA_ZIP,regexSummary:n2.maps.Constants.REGEX_USA_ZIP_SUMMARY,hasState:!0},CAN:{regex:n2.maps.Constants.REGEX_CAN_POSTAL,hasState:!0},GBR:{regex:n2.maps.Constants.REGEX_GBR_POSTAL,regexSummary:n2.maps.Constants.REGEX_GBR_POSTAL_SUMMARY},FRA:{regex:n2.maps.Constants.REGEX_FRA_POSTAL,regexSummary:n2.maps.Constants.REGEX_FRA_POSTAL_SUMMARY},DEU:{regex:n2.maps.Constants.REGEX_DEU_POSTAL,regexSummary:n2.maps.Constants.REGEX_DEU_POSTAL_SUMMARY},AUS:{regex:n2.maps.Constants.REGEX_AUS_NZL_POSTAL,regexSummary:n2.maps.Constants.REGEX_AUS_NZL_POSTAL_SUMMARY,hasState:!0},NZL:{regex:n2.maps.Constants.REGEX_AUS_NZL_POSTAL,regexSummary:n2.maps.Constants.REGEX_AUS_NZL_POSTAL_SUMMARY}},n2.maps.Constants.IMPORT_COUNTRIES={AUS:"Australia",CAN:"Canada",DEU:"Germany",FRA:"France",GBR:"United Kingdom",NZL:"New Zealand",USA:"United States of America"},ncsquared.maps.Context={mappingData:null,map:null,territories:[],geometries:{},currentTerritoryIndex:-1,loadedFeatures:0,breadcrumb:[{name:"World",id:"W",type:n2.maps.Constants.ZOOM_TYPE_COUNTRY}],currentType:null,currentItems:null,territoriesFilter:null,clickTimeout:null,clickEvent:null,infoWindow:null,shiftPressed:!1,mouseDown:!1,mouseDownPosition:null,selectionBox:null,config:null,init:function(t){n2.util.checkRequiredConfig(t,["isEditable:boolean","map:string","saveTerritoryHandler:function","saveTerritoryDeleteHandler:function","saveTerritorieReorderHandler:function","editModeHandler:function","noTerritoriesHandler:function","editTerritoryPropertiesHandler:function","deleteTerritoryHandler:function","breadcrumb:string","territories:string","maxItems:number"]),this.config=t}},ncsquared.maps.Features={loadGeoJsonData:function(e){n2.spinner.show(),n2.maps.Breadcrumb.updatePanel(),n2.maps.Context.map.data.forEach(function(t){n2.maps.Context.map.data.remove(t)});var t=n2.maps.Constants.GEOJSON_URL,n=n2.maps.Breadcrumb.getCurrentItem(),s=n.stateParent?3:2,a=n2.maps.Breadcrumb.length(),r=n2.maps.Context.breadcrumb[Math.min(s,a)-1];1<a&&(t+=n.type+"/"),t+=r.id+".geojson",n2.sf.heroku.get(t).done(function(t){if(!t.features)throw new Error("Invalid structure of GeoJson data");n.type===n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL&&(t.features=n2.util.map(t.features,function(t){return t.properties&&t.properties.parent&&t.properties.parent!==n.id?null:t})),n2.maps.Context.loadedFeatures=t.features.length,n2.util.isNullOrUndefined(e)&&(e=n2.maps.Constants.ZOOM_TYPE_STATE===r.type&&n2.maps.Constants.COUNTRY_BOUNDS.hasOwnProperty(r.id)?n2.maps.Constants.COUNTRY_BOUNDS[r.id]:t.bbox),n2.util.isArray(e)&&(e=4===e.length?{west:e[0],south:e[1],east:e[2],north:e[3]}:n2.maps.Constants.DEFAULT_BOUNDS),n2.maps.Context.map.fitBounds(e||n2.maps.Constants.DEFAULT_BOUNDS),n2.maps.Zoom.updateCurrentZoomType(),n2.maps.Context.map.data.addGeoJson(t)}).fail(function(t,e,n){n2.spinner.hide(),n2.message.error("Failed to load GeoJSON: "+(n||t.status))}).always(function(){setTimeout(n2.spinner.hide,5e3)})},getFeatureStyle:function(t){var e=n2.util.clone(n2.maps.Constants.STYLE_DEFAULT,!0),n=t.getId(),s=t.getProperty("canBeZoomed");if(n2.util.isNullOrUndefined(s)&&(s=n2.maps.Zoom.canBeZoomed(n),t.setProperty("canBeZoomed",s)),s&&Object.assign(e,n2.maps.Constants.STYLE_ZOOMABLE),n){var a=n2.maps.Zoom.getCurrentZoomType(),r=n2.maps.Breadcrumb.getCurrentItem().country;n2.maps.TerritoryItems.isSelectedInCurrent(n,a,r)?(Object.assign(e,n2.maps.Constants.STYLE_SELECTED),0<=n2.maps.Context.currentTerritoryIndex&&n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex].color&&(e.fillColor=n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex].color),n2.maps.Context.config.isEditable||s||(e.clickable=!1)):-1!==n2.maps.TerritoryItems.getTerritoryIndex(n,a,r)?(Object.assign(e,n2.maps.Constants.STYLE_SELECTED_OTHER),s&&(e.clickable=!0)):n2.maps.Context.config.isEditable||s||(e.clickable=!1)}else e.strokeWeight=0;var o=t.getProperty("color");return o&&(e.fillColor=o,e.fillOpacity=.5),0<n2.maps.Context.loadedFeatures&&(n2.maps.Context.loadedFeatures--,0===n2.maps.Context.loadedFeatures&&n2.spinner.hide()),e}},ncsquared.maps.HTML={},n2.maps.HTML.HTML_BREADCRUMB='{{#.}}<li class="slds-breadcrumb__item">{{#last}}<span>{{/last}}{{^last}}<a class="n2__breadcrumb-item" data-index="{{index}}">{{/last}}{{name}}{{#typeDescription}} ({{typeDescription}}){{/typeDescription}}{{#last}}<span>{{/last}}{{^last}}</a>{{/last}}</li>{{/.}}',n2.maps.HTML.HTML_TERRITORIES_LIST='{{#territories}}<li class="n2__territory-item"><div class="slds-grid"><h3 class="slds-text-heading_small slds-truncate slds-col"><button class="slds-button slds-button_reset n2__territory-item-btn" title="{{name}}" data-index="{{_index}}" style="width: 100%"><span class="slds-swatch n2__territory-dot" style="background-color: {{color}}"></span><span class="slds-truncate">({{executionOrder}}) {{name}}</span></button></h3>'+ncsquared.ui.Dropdown.renderStartTemplate(!1)+'{{#isEditable}}<li class="slds-dropdown__item" role="presentation"><a class="n2__territory-edit-items" data-index="{{_index}}" role="menuitem" tabindex="0"><span class="slds-truncate" title="Choose Items">Choose Items</span></a></li><li class="slds-dropdown__item" role="presentation"><a class="n2__territory-edit-properties" data-index="{{_index}}" role="menuitem" tabindex="0"><span class="slds-truncate" title="Edit Properties">Edit Properties</span></a></li><li class="slds-dropdown__item" role="presentation"><a class="n2__territory-edit-delete" data-index="{{_index}}" role="menuitem" tabindex="-1"><span class="slds-truncate" title="Delete Territory">Delete Territory</span></a></li>{{/isEditable}}{{^isEditable}}<li class="slds-dropdown__item" role="presentation"><a class="n2__territory-edit-items" data-index="{{_index}}" role="menuitem" tabindex="0"><span class="slds-truncate" title="View Items">View Items</span></a></li>{{/isEditable}}'+ncsquared.ui.Dropdown.endTemplate+"</div></li>{{/territories}}",n2.maps.HTML.HTML_TERRITORY_ITEMS_LIST='{{#types}}{{#items.length}}<li class="n2__territory-type" data-type="{{type}}"><span class="n2__color-primary">{{name}}</span><div><ul class="slds-listbox slds-listbox_horizontal slds-listbox_inline" role="listbox" aria-orientation="horizontal">{{#items}}<li class="slds-listbox-item" role="presentation"><span class="slds-pill" role="option"><span class="slds-pill__label">{{resolvedName}}</span>{{#canRemove}}<button title="Remove" data-id="{{id}}" class="slds-button slds-button_icon slds-button_icon slds-pill__remove n2__remove-territory-feature"><svg class="slds-button__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{{sldsIconsPrefix}}/utility-sprite/svg/symbols.svg#close" /></svg><span class="slds-assistive-text">Remove</span></button>{{/canRemove}}</span></li>{{/items}}</ul></li>{{/items.length}}{{/types}}',n2.maps.HTML.HTML_ZOOM_POPOVER='<div class="slds-popover_body">{{#isEditable}}<div><button class="slds-button" onclick="n2.maps.TerritoryItems.itemClick();n2.maps.Context.clickEvent = null;">{{#selected}}Un-select{{/selected}}{{^selected}}Select{{/selected}}</button></div>{{/isEditable}}{{#zoomTypes}}<div><button class="slds-button" onclick="n2.maps.Zoom.zoomFeature(\'{{type}}\');n2.maps.Context.clickEvent = null;">Zoom to {{description}}</button></div>{{/zoomTypes}}</div>',ncsquared.maps.Import={MASK_OFFSET:5,MASK_MIN:97,MASK_MAX:122,MASK_DIFF:26,_zipStateData:null,getTerritoryItems:function(t,e,n){return n2.util.isNullOrUndefined(n2.maps.Import._zipStateData)?n2.maps.Import._fetchZipStateData().then(function(){return n2.maps.Import._resolveTerritoryItems(t,e,n)}):n2.maps.Import._resolveTerritoryItems(t,e,n)},_fetchZipStateData:function(){return n2.sf.heroku.get("/json/zip-state.json").done(function(t){n2.maps.Import._zipStateData=t}).fail(function(t,e,n){n2.message.error("Failed to fetch zip-state.json: "+(n||t.status))})},_resolveTerritoryItems:function(t,e,r){var n,s={},o={};n2.util.each(t,function(t,e){n=n2.maps.Import.cleanName(e),o[n]=n2.maps.Import.maskName(n),s.hasOwnProperty(n)?s[n]+='", "'+e:s[n]=e});var i=[],a=e===n2.maps.Constants.IMPORT_TYPE_AUTODETECT,m=(r=r||n2.maps.Constants.IMPORT_TYPE_AUTODETECT)===n2.maps.Constants.IMPORT_TYPE_AUTODETECT;(a||e===n2.maps.Constants.ZOOM_TYPE_POSTAL)&&n2.util.each(o,function(a){n2.util.each(n2.maps.Constants.IMPORT_POSTAL,function(t,e){if((m||r===t)&&e.regex.test(a)&&n2.maps.Import._zipStateData.hasOwnProperty(t)&&n2.maps.Import._zipStateData[t].hasOwnProperty(a)){var n=a.toUpperCase(),s={id:n,_name:n,_type:e.regexSummary&&e.regexSummary.test(a)?n2.maps.Constants.ZOOM_TYPE_POSTAL:n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL,c:t};return e.hasState&&(s.s=t+"-"+n2.maps.Import._zipStateData[t][a]),i.push(s),delete o[a],!1}})}),(a||e===n2.maps.Constants.ZOOM_TYPE_STATE)&&n2.util.each(n2.maps.Constants.IMPORT_STATE_COUNTRIES,function(t,e){(m||r===e)&&n2.maps.Import._resolveStates(o,i,e)}),0<Object.keys(o).length&&(a||e===n2.maps.Constants.ZOOM_TYPE_COUNTRY)&&n2.util.each(o,function(t,e){if(n2.maps.Context.mappingData.countries.hasOwnProperty(e)){var n=n2.maps.Context.mappingData.countries[e];i.push({id:n,_name:n2.maps.Context.mappingData.countryNames[n],_type:n2.maps.Constants.ZOOM_TYPE_COUNTRY}),delete o[t]}});var p=[];n2.util.eachBackwards(i,function(t,e){(n2.maps.TerritoryItems.isSelectedInCurrent(e.id,e._type,e.c)||n2.maps.TerritoryItems.isSelectedInTerritories(e.id,e._type,e.c))&&(-1===p.indexOf(e._name)&&p.push(e._name),i.splice(t,1))});var l={pills:i.sort(function(t,e){return n2.util.compareObjectValues(t,e,"_name")}),message:""},u=Object.keys(o);if(0<u.length){var c=n2.util.map(u,function(t){return s[t]}).join('", "');l.message='The following items were not recognized: "'+c+'".'}return 0<p.length&&(0<u.length&&(l.message+="\n"),l.message+='The following items were resolved but already exist in a territory: "'+p.join('", "')+'".'),l},_resolveStates:function(s,a,r){if(0<Object.keys(s).length&&n2.maps.Context.mappingData.states.hasOwnProperty(r)){var o=n2.maps.Context.mappingData.states[r];n2.util.each(s,function(t,e){if(o.hasOwnProperty(e)){var n=o[e];a.push({id:n,_name:n2.maps.Context.mappingData.stateNames[n],_type:n2.maps.Constants.ZOOM_TYPE_STATE,c:r}),delete s[t]}})}},cleanName:function(t){return t?(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(n2.maps.Constants.REGEX_A,"a")).replace(n2.maps.Constants.REGEX_E,"e")).replace(n2.maps.Constants.REGEX_I,"i")).replace(n2.maps.Constants.REGEX_O,"o")).replace(n2.maps.Constants.REGEX_U,"u")).replace(n2.maps.Constants.REGEX_C,"c")).replace(n2.maps.Constants.REGEX_N,"n")).replace(n2.maps.Constants.REGEX_AND,"and")).replace(n2.maps.Constants.REGEX_SPACE," ")).replace(n2.maps.Constants.REGEX_OTHER,"")).replace(n2.maps.Constants.REGEX_MULTIPLE_SPACES," ")).trim().toLowerCase():t},maskName:function(t){if(!t)return t;for(var e,n,s=t.length,a=[],r=0;r<s;r++)(e=t.charCodeAt(r))>=n2.maps.Import.MASK_MIN&&e<=n2.maps.Import.MASK_MAX?((n=e+n2.maps.Import.MASK_OFFSET)>n2.maps.Import.MASK_MAX&&(n-=n2.maps.Import.MASK_DIFF),a.push(n)):a.push(e);return String.fromCharCode.apply(null,a)}},ncsquared.maps.Mouse={featureMouseOver:function(t){if(n2.maps.Context.map.data.revertStyle(),n2.maps.Context.shiftPressed)n2.maps.Context.map.data.overrideStyle(t.feature,{clickable:!1});else{n2.maps.Context.currentItems&&n2.maps.Context.map.data.overrideStyle(t.feature,n2.maps.Constants.STYLE_HOVER);var e=t.feature.getProperty("name");!0===t.feature.getProperty("canBeZoomed")&&(e+=" (Double-click to zoom)"),n2.maps.Context.map.getDiv().setAttribute("title",e)}},featureMouseOut:function(){n2.maps.Context.shiftPressed||(n2.maps.Context.map.data.revertStyle(),n2.maps.Context.map.getDiv().removeAttribute("title"))},featureClick:function(t){!n2.maps.Context.shiftPressed&&n2.maps.Context.config.isEditable&&n2.maps.Context.currentItems&&(n2.maps.Context.clickEvent=t,n2.maps.Context.clickTimeout=setTimeout(function(){n2.maps.TerritoryItems.itemClick(),n2.maps.Context.clickEvent=null,n2.maps.Context.clickTimeout=null},n2.maps.Constants.CLICK_DELAY))},featureDoubleClick:function(t){if(!n2.maps.Context.shiftPressed&&n2.maps.Context.currentItems){n2.maps.Context.clickTimeout&&(clearTimeout(n2.maps.Context.clickTimeout),n2.maps.Context.clickEvent=null,n2.maps.Context.clickTimeout=null);var e=t.feature.getId();if(n2.maps.Zoom.canBeZoomed(e)){n2.maps.Context.clickEvent=t;var n=n2.maps.Zoom.getZoomTypes(e);n2.maps.Zoom.zoomFeature(n[0].type),n2.maps.Context.clickEvent=null}}},featureRightClick:function(t){if(!n2.maps.Context.shiftPressed&&n2.maps.Context.currentItems){var e=t.feature.getId();if(n2.maps.Zoom.canBeZoomed(e)){n2.maps.Context.clickEvent=t;var n=n2.maps.Zoom.getZoomTypes(e);n2.util.each(n,function(t,e){e.description=n2.maps.Constants.ZOOM_TYPE_DESCRIPTIONS[e.type]});var s={isEditable:n2.maps.Context.config.isEditable,selected:n2.maps.TerritoryItems.isSelectedInCurrent(e,n2.maps.Zoom.getCurrentZoomType(),n2.maps.Breadcrumb.getCurrentItem().country),zoomTypes:n},a=n2.ui.renderTemplate(n2.maps.HTML.HTML_ZOOM_POPOVER,s);n2.maps.Context.infoWindow.setContent(a),n2.maps.Context.infoWindow.setPosition(t.latLng),n2.maps.Context.infoWindow.open(n2.maps.Context.map)}}},selectionMouseDown:function(t){n2.maps.Context.infoWindow.close(),n2.maps.Context.shiftPressed&&n2.maps.Context.config.isEditable&&(n2.maps.Context.mouseDown=!0,n2.maps.Context.mouseDownPosition=t.latLng,n2.maps.Context.map.setOptions({draggable:!1}))},selectionMouseUp:function(){if(n2.maps.Context.map.data.revertStyle(),n2.maps.Context.mouseDown&&(n2.maps.Context.mouseDown=!1,n2.maps.Context.mouseDownPosition=null,n2.maps.Context.map.setOptions({draggable:!0}),n2.maps.Context.selectionBox)){var a=!1,r=n2.maps.Context.selectionBox.getBounds(),o=n2.maps.Zoom.getCurrentZoomType(),i=n2.maps.Breadcrumb.getCurrentItem();n2.maps.Context.map.data.forEach(function(n){var t=n.getProperty("parent"),e=!t||i.id===t,s=n.getId();!e||n2.maps.TerritoryItems.isSelectedInCurrent(s,o,i.country)||n2.maps.TerritoryItems.isSelectedInTerritories(s,o,i.country)||(a=!1,n.getGeometry().forEachLatLng(function(t){if(!a&&r.contains(t)){n2.maps.TerritoryItems.addItem(n.getId(),o);var e=n2.maps.Constants.STYLE_SELECTED;0<=n2.maps.Context.currentTerritoryIndex&&n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex].color&&(e.fillColor=n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex].color),n2.maps.Context.map.data.overrideStyle(n,e),a=!0}}))}),n2.maps.TerritoryItems.updatePanel(),n2.maps.Context.selectionBox.setMap(),n2.maps.Context.selectionBox=null}},selectionMouseMove:function(t){if(n2.maps.Context.shiftPressed&&n2.maps.Context.mouseDown)if(n2.maps.Context.selectionBox){var e={};t.latLng.lat()>=n2.maps.Context.mouseDownPosition.lat()?(e.north=t.latLng.lat(),e.south=n2.maps.Context.mouseDownPosition.lat()):(e.north=n2.maps.Context.mouseDownPosition.lat(),e.south=t.latLng.lat()),t.latLng.lng()>=n2.maps.Context.mouseDownPosition.lng()?(e.east=t.latLng.lng(),e.west=n2.maps.Context.mouseDownPosition.lng()):(e.east=n2.maps.Context.mouseDownPosition.lng(),e.west=t.latLng.lng()),n2.maps.Context.selectionBox.setBounds(e)}else n2.maps.Context.selectionBox=new google.maps.Rectangle({map:n2.maps.Context.map,bounds:new google.maps.LatLngBounds(t.latLng,t.latLng),fillOpacity:.3,strokeWeight:.5,clickable:!1})}},ncsquared.maps.Setup={initMap:function(){if(!n2.maps.Context.stopInit){if(n2.util.isNullOrUndefined(n2.maps.Context.config))return n2.spinner.hide(),void n2.message.error("The maps context has not been initialised");n2.spinner.show();var t=n2.util.promise(),e=n2.sf.heroku.get("/json/mapping-data.json").done(function(t){n2.util.isFunction(n2.maps.Context.config.mappingDataLoadedHandler)&&n2.maps.Context.config.mappingDataLoadedHandler(t)}).fail(function(t,e,n){n2.spinner.hide(),n2.message.error("Failed to fetch mapping-data.json: "+(n||t.status))}),n=n2.maps.Context.config.loadTerritoriesPromise,s=n2.maps.Context.config.loadGeometriesPromise;n2.util.isNullOrUndefined(n)&&(n=n2.util.promise()).resolve([]),n2.util.isNullOrUndefined(s)&&(s=n2.util.promise()).resolve({}),n2j$.when(e,n,s,t).done(function(t,e,n){n2.maps.Context.mappingData=t[0].data,n2.maps.Context.territories=e||[],e.length<=n2.maps.Constants.MAX_TERRITORIES_FOR_SUMMARY&&(n2.maps.Context.geometries=n||{}),n2.maps.Territories.loadTerritories(),n2.spinner.hide()}),n2.maps.Context.infoWindow=new google.maps.InfoWindow;var a=n2.maps.Context.map=new google.maps.Map(document.getElementById(n2.maps.Context.config.map),{zoom:2,minZoom:2,center:{lat:0,lng:0},gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[]}});a.data.setStyle(n2.maps.Features.getFeatureStyle),a.data.addListener("mouseover",n2.maps.Mouse.featureMouseOver),a.data.addListener("mouseout",n2.maps.Mouse.featureMouseOut),a.data.addListener("click",n2.maps.Mouse.featureClick),a.data.addListener("dblclick",n2.maps.Mouse.featureDoubleClick),a.data.addListener("rightclick",n2.maps.Mouse.featureRightClick),a.addListener("mousedown",n2.maps.Mouse.selectionMouseDown),a.data.addListener("mousedown",n2.maps.Mouse.selectionMouseDown),a.addListener("mouseup",n2.maps.Mouse.selectionMouseUp),a.data.addListener("mouseup",n2.maps.Mouse.selectionMouseUp),a.addListener("mousemove",n2.maps.Mouse.selectionMouseMove),a.data.addListener("mousemove",n2.maps.Mouse.selectionMouseMove),n2.maps.Setup.addWindowHandlers(),n2.maps.Setup.addDocumentHandlers(),t.resolve()}},addWindowHandlers:function(){n2j$(window).keydown(function(t){!n2.maps.Context.shiftPressed&&t.which===n2.key.KEY_SHIFT&&n2.maps.Context.config.isEditable&&n2.maps.Context.currentItems&&(n2.maps.Context.shiftPressed=!0,n2.maps.Context.map.setOptions({draggableCursor:"crosshair"}),n2.maps.Context.map.data.revertStyle())}).keyup(function(t){n2.maps.Context.shiftPressed&&t.which===n2.key.KEY_SHIFT&&(n2.maps.Context.shiftPressed=!1,n2.maps.Context.map.setOptions({draggableCursor:""}),n2.maps.Context.map.data.revertStyle())})},addDocumentHandlers:function(){var t=function(t){return Number(t.getAttribute("data-index"))};n2j$(document).on("click",n2.maps.Context.config.territories+" button.n2__territory-item-btn",function(){n2.maps.Territories.loadTerritory(t(this))}).on("click",n2.maps.Context.config.territories+" button.n2__remove-territory-feature",function(){var t=n2j$(this);n2.maps.TerritoryItems.removeItem(t.attr("data-id"),t.closest("li.n2__territory-type").attr("data-type"))}).on("click",n2.maps.Context.config.territories+" a.n2__territory-edit-items",function(){n2.maps.Territories.loadTerritory(t(this))}).on("click",n2.maps.Context.config.territories+" a.n2__territory-edit-properties",function(){n2.maps.Context.config.editTerritoryPropertiesHandler(n2.maps.Context.territories[t(this)])}).on("click",n2.maps.Context.config.territories+" a.n2__territory-edit-delete",function(){n2.maps.Context.config.deleteTerritoryHandler(n2.maps.Context.territories[t(this)])}).on("click",n2.maps.Context.config.breadcrumb+" a.n2__breadcrumb-item",function(){n2.maps.Breadcrumb.loadFromBreadcrumb(this.getAttribute("data-index"))})}},ncsquared.maps.Territories={loadTerritories:function(){n2.spinner.show(),n2.maps.Context.currentItems=null,n2.maps.Context.currentTerritoryIndex=-1,n2.maps.Breadcrumb.reset(),n2.maps.Breadcrumb.updatePanel(),n2.maps.Context.config.editModeHandler(!1),n2.maps.Context.map.data.forEach(function(t){n2.maps.Context.map.data.remove(t)});var t=n2.maps.Context.territories.length;if(0===t)n2.maps.Context.config.noTerritoriesHandler(!0),n2j$(n2.maps.Context.config.territories).html(""),n2.spinner.hide();else{n2.maps.Context.config.noTerritoriesHandler(!1);var n={type:"FeatureCollection",features:[]},s=0;t<=n2.maps.Constants.MAX_TERRITORIES_FOR_SUMMARY&&n2.util.each(n2.maps.Context.territories,function(t,e){n2.maps.Context.geometries.hasOwnProperty(e.name)?n.features.push(n2.maps.Context.geometries[e.name]):s++}),n2.maps.Context.loadedFeatures=t-s,n2.maps.Context.map.fitBounds(n2.maps.Constants.DEFAULT_BOUNDS),n2.maps.Context.map.data.addGeoJson(n),n2.maps.Territories.sortTerritories(),n2.maps.Territories.updatePanel(n2.maps.Context.territoriesFilter),setTimeout(n2.spinner.hide,0===n2.maps.Context.loadedFeatures?0:5e3)}},sortTerritories:function(){n2.maps.Context.territories.sort(function(t,e){return n2.util.compareObjectValues(t,e,"executionOrder")}),n2.util.each(n2.maps.Context.territories,function(t,e){e._index=t})},updatePanel:function(e){n2.util.isNullOrUndefined(e)||(e=e.toLowerCase()),n2.maps.Context.territoriesFilter=e;var t=n2.util.map(n2.maps.Context.territories,function(t){return e&&-1===t.name.toLowerCase().indexOf(e)?null:{_index:t._index,color:t.color,executionOrder:t.executionOrder,name:t.name}}),n=n2.ui.renderTemplate(n2.maps.HTML.HTML_TERRITORIES_LIST,{territories:t,isEditable:n2.maps.Context.config.isEditable});n2j$(n2.maps.Context.config.territories).html(n)},loadTerritory:function(t){t=Number(t),n2.maps.Context.currentTerritoryIndex=t;var e=n2.maps.Context.territories[t];if(n2.maps.Context.currentItems=n2.util.clone(e.items),n2.maps.Breadcrumb.reset(),n2.maps.Context.config.editModeHandler(!0,e.name),n2.maps.TerritoryItems.updatePanel(),n2.util.isArray(e.defaultZoom)&&0<e.defaultZoom.length){var n=e.defaultZoom[0].id,s=n2.maps.Constants.ZOOM_COUNTRIES_TYPES[n];n2.util.each(e.defaultZoom,function(t,e){s&&-1!==s.indexOf(e.type)&&n2.maps.Breadcrumb.addItem(e.id,e.type)})}var a=n2.maps.Context.geometries[e.name]||{};n2.maps.Features.loadGeoJsonData(a.bbox)},createTerritory:function(t,e){var n={name:t,color:e||n2.maps.Constants.TERRITORY_COLORS[n2.maps.Context.territories.length],items:{},executionOrder:n2.maps.Context.territories.length+1},s=n2.util.clone(n2.maps.Context.territories);return n2.maps.Context.territories.push(n),n2.maps.Territories.saveTerritory(n).done(function(){n2.maps.Territories.sortTerritories(),n2.maps.Territories.updatePanel(n2.maps.Context.territoriesFilter),n2.maps.Territories.loadTerritory(n2.maps.Context.territories.indexOf(n))}).fail(function(){n2.maps.Context.territories=s})},updateTerritory:function(t,e,n){var s,a=n2.maps.Context.territories[t],r=n2.util.clone(a);return n2.maps.Context.geometries.hasOwnProperty(a.name)&&((s=n2.maps.Context.geometries[a.name]).properties.name=e,s.properties.color=n,delete n2.maps.Context.geometries[a.name],n2.maps.Context.geometries[e]=s),a.name=e,a.color=n,n2.maps.Territories.saveTerritory(a,s).done(function(){n2.maps.Territories.sortTerritories(),n2.maps.Territories.updatePanel(n2.maps.Context.territoriesFilter),n2.maps.Context.map.data.forEach(function(t){n2.maps.Context.map.data.revertStyle(t)})}).fail(function(){n2.maps.Context.territories[t]=r})},updateCurrentTerritoryItems:function(){n2.spinner.show();var s=n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex],t=n2.maps.Constants.COMBINE_URL+"?name="+encodeURIComponent(s.name)+"&color="+encodeURIComponent(s.color);n2.sf.heroku.post(t,n2.maps.Context.currentItems).done(function(t){var e=n2.util.clone(s);s.items=n2.maps.Context.currentItems,s.defaultZoom=t.defaultZoom;var n=n2.maps.Context.territories.length<=n2.maps.Constants.MAX_TERRITORIES_FOR_SUMMARY;n2.maps.Territories.saveTerritory(s,n?t.feature:"").done(function(){n&&(n2.maps.Context.geometries[s.name]=t.feature),n2.maps.Territories.loadTerritories(),n2.spinner.hide()}).fail(function(){n2.maps.Context.territories[n2.maps.Context.currentTerritoryIndex]=e,n2.spinner.hide()})}).fail(function(t,e,n){n2.spinner.hide(),n2.message.error("Failed to generate the combined territory shape: "+(n||t.status))})},saveTerritory:function(t,e){n2.maps.Territories._cleanTerritory(t);var n=n2.maps.Context.config.saveTerritoryHandler(t,e);return n2.util.isPromise(n)?n:n2.util.promise().resolve()},deleteTerritory:function(t){var e=n2.util.clone(n2.maps.Context.territories),n=n2.maps.Context.territories.splice(Number(t),1);if(1===n.length){n2.util.each(n2.maps.Context.territories,function(t,e){e.executionOrder=t+1}),n2.maps.Territories._cleanTerritory(n[0]);var s=n2.maps.Context.config.saveTerritoryDeleteHandler(n[0]);n2.util.isPromise(s)?s.done(function(){n2.maps.Territories.loadTerritories(),delete n2.maps.Context.geometries[n[0].name]}).fail(function(){n2.maps.Context.territories=e}):(n2.maps.Territories.loadTerritories(),delete n2.maps.Context.geometries[n[0].name])}},reorderTerritories:function(n){if(0<Object.keys(n).length){var t=n2.util.clone(n2.maps.Context.territories);n2.util.each(n2.maps.Context.territories,function(t,e){n.hasOwnProperty(e.executionOrder)&&(e.executionOrder=n[e.executionOrder])}),n2.maps.Territories.sortTerritories();var e=n2.maps.Context.config.saveTerritorieReorderHandler(n);return n2.util.isPromise(e)?e.done(function(){n2.maps.Territories.updatePanel(n2.maps.Context.territoriesFilter)}).fail(function(){return n2.maps.Context.territories=t,!1}):(n2.maps.Territories.updatePanel(n2.maps.Context.territoriesFilter),n2.util.promise().resolve())}},_cleanTerritory:function(t){n2.util.eachDeep(t,function(t,e){n2.util.isString(e)&&0===e.indexOf("_")&&delete t[e]})}},ncsquared.maps.TerritoryItems={_getIndex:function(t,n,e,s){var a=-1;return t&&t.hasOwnProperty(e)&&n2.util.each(t[e],function(t,e){if(n===e.id&&(!s||s===e.c))return a=t,!1}),a},isSelectedInCurrent:function(t,e,n){return-1!==n2.maps.TerritoryItems._getIndex(n2.maps.Context.currentItems,t,e,n)},getTerritoryIndex:function(n,s,a){var r=-1;return n2.util.each(n2.maps.Context.territories,function(t,e){if(t!==n2.maps.Context.currentTerritoryIndex&&-1!==n2.maps.TerritoryItems._getIndex(e.items,n,s,a))return r=t,!1}),r},isSelectedInTerritories:function(t,e,n){return-1!==n2.maps.TerritoryItems.getTerritoryIndex(t,e,n)},itemClick:function(){if(n2.maps.Context.infoWindow.close(),n2.maps.Context.clickEvent){var t=n2.maps.Context.clickEvent.feature.getId(),e=n2.maps.Zoom.getCurrentZoomType(),n=n2.maps.Breadcrumb.getCurrentItem().country;if(!n2.maps.TerritoryItems.isSelectedInTerritories(t,e,n)){var s=n2.maps.TerritoryItems._getIndex(n2.maps.Context.currentItems,t,e,n);-1===s?n2.maps.TerritoryItems.addItem(t,e):(n2.maps.Context.currentItems[e].splice(s,1),0===n2.maps.Context.currentItems[e].length&&delete n2.maps.Context.currentItems[e]),n2.maps.Context.map.data.revertStyle(),n2.maps.Context.map.data.overrideStyle(n2.maps.Context.clickEvent.feature,n2.maps.Constants.STYLE_HOVER),n2.maps.TerritoryItems.updatePanel()}}},addItem:function(t,e){if(n2.maps.TerritoryItems._checkMaxItems(n2.maps.TerritoryItems.getCurrentItemsCount())){n2.maps.Context.currentItems.hasOwnProperty(e)||(n2.maps.Context.currentItems[e]=[]);var n={id:t};1<n2.maps.Breadcrumb.length()&&(n.c=n2.maps.Context.breadcrumb[1].id,n2.maps.Breadcrumb.getCurrentItem().stateParent&&(n.s=n2.maps.Context.breadcrumb[2].id)),n2.maps.Constants.ZOOM_TYPE_COUNTRY===e?n._name=n2.maps.Context.mappingData.countryNames[t]:n2.maps.Constants.ZOOM_TYPE_STATE===e&&(n._name=n2.maps.Context.mappingData.stateNames[t]),n2.maps.Context.currentItems[e].push(n)}},addItems:function(t){var n=n2.maps.TerritoryItems.getCurrentItemsCount(),s=n2.maps.Breadcrumb.getCurrentItem().country;n2.util.each(t,function(t,e){if(!n2.maps.TerritoryItems.isSelectedInCurrent(e.id,e._type,s)&&!n2.maps.TerritoryItems.isSelectedInTerritories(e.id,e._type,s)){if(!n2.maps.TerritoryItems._checkMaxItems(n))return!1;n++,n2.maps.Context.currentItems.hasOwnProperty(e._type)?n2.maps.Context.currentItems[e._type].push(e):n2.maps.Context.currentItems[e._type]=[e]}}),n2.maps.TerritoryItems.updatePanel(),n2.maps.Context.map.data.forEach(function(t){n2.maps.Context.map.data.revertStyle(t)})},removeItem:function(t,e){var n=n2.maps.TerritoryItems._getIndex(n2.maps.Context.currentItems,t,e);if(-1!==n){n2.maps.Context.currentItems[e].splice(n,1),0===n2.maps.Context.currentItems[e].length&&delete n2.maps.Context.currentItems[e],n2.maps.TerritoryItems.updatePanel();var s=n2.maps.Context.map.data.getFeatureById(t);n2.util.isNullOrUndefined(s)||n2.maps.Context.map.data.revertStyle(s)}},updatePanel:function(){var s,a,r,o={resolvedName:function(){return this._name||this.id},canRemove:n2.maps.Context.config.isEditable&&0<=n2.maps.Context.currentTerritoryIndex,types:[{name:n2.maps.Constants.ZOOM_TYPE_DESCRIPTIONS[n2.maps.Constants.ZOOM_TYPE_COUNTRY],type:n2.maps.Constants.ZOOM_TYPE_COUNTRY,order:0,items:[]}]},i=[n2.maps.Constants.ZOOM_TYPE_COUNTRY],m=this;n2.util.each(n2.maps.Context.currentItems,function(n,t){n2.maps.Constants.ZOOM_TYPE_COUNTRY===n?(n2.util.each(t,function(t,e){m.populateItemName(n,e)}),o.types[0].items=t):n2.util.each(t,function(t,e){m.populateItemName(n,e),s=n+"-"+e.c+"-"+e.s,-1===(a=i.indexOf(s))?(i.push(s),r=n2.maps.Constants.ZOOM_TYPE_DESCRIPTIONS[n]+" - "+n2.maps.Context.mappingData.countryNames[e.c],n2.util.isNullOrUndefined(e.s)||(r+=" - "+n2.maps.Context.mappingData.stateNames[e.s]),o.types.push({name:r,type:n,order:n2.maps.Constants.ZOOM_TYPES.indexOf(n),items:[e]})):o.types[a].items.push(e)})}),o.types.sort(function(t,e){var n=n2.util.compareObjectValues(t,e,"order");return 0===n?n2.util.compareObjectValues(t,e,"name"):n}),n2.util.each(o.types,function(t,e){e.items.sort(function(t,e){var n=n2.util.compareObjectValues(t,e,"_name");return 0===n?n2.util.compareObjectValues(t,e,"id"):n})});var t=n2.ui.renderTemplate(n2.maps.HTML.HTML_TERRITORY_ITEMS_LIST,o);n2j$(n2.maps.Context.config.territories).html(t)},populateItemName:function(t,e){e.hasOwnProperty("_name")||(n2.maps.Constants.ZOOM_TYPE_COUNTRY===t?e._name=n2.maps.Context.mappingData.countryNames[e.id]:n2.maps.Constants.ZOOM_TYPE_STATE===t&&(e._name=n2.maps.Context.mappingData.stateNames[e.id]))},getCurrentItemsCount:function(){var n=0;return n2.util.isNullOrUndefined(n2.maps.Context.currentItems)||n2.util.each(n2.maps.Context.currentItems,function(t,e){n+=e.length}),n},hasTerritoryItems:function(){if(!n2.util.isNullOrUndefined(n2.maps.Context.currentItems)&&0<Object.keys(n2.maps.Context.currentItems).length)return!0;var n=!1;return n2.util.each(n2.maps.Context.territories,function(t,e){if(t!==n2.maps.Context.currentTerritoryIndex&&(n2.util.each(e.items,function(t,e){if(0<Object.keys(e).length)return!(n=!0)}),n))return!1}),n},_checkMaxItems:function(t){return!(t>=n2.maps.Context.config.maxItems&&(n2.message.show({text:"You have reached the maximum number of items that you can add to a territory: "+n2.maps.Context.config.maxItems,heading:"Too Many Items",theme:"warning"}),1))}},ncsquared.maps.Zoom={canBeZoomed:function(t){if(t){var e=n2.maps.Breadcrumb.length();if(1===e)return n2.maps.Constants.ZOOM_COUNTRIES.hasOwnProperty(t);if(1<e&&n2.maps.Context.currentType)return n2.maps.Context.currentType.children&&0<n2.maps.Context.currentType.children.length}},getZoomTypes:function(t){return t?n2.maps.Context.currentType?n2.maps.Context.currentType.children:n2.maps.Constants.ZOOM_COUNTRIES[t].children:[]},getCurrentZoomType:function(){return n2.maps.Context.currentType?n2.maps.Context.currentType.type:n2.maps.Constants.ZOOM_TYPE_COUNTRY},updateCurrentZoomType:function(){1<n2.maps.Breadcrumb.length()?(n2.maps.Context.currentType=n2.maps.Constants.ZOOM_COUNTRIES[n2.maps.Context.breadcrumb[1].id],n2.maps.Context.currentType.children&&n2.util.each(n2.maps.Context.breadcrumb,function(t,n){n2.util.each(n2.maps.Context.currentType.children,function(t,e){if(e.type===n.type)return n2.maps.Context.currentType=e,!1})})):n2.maps.Context.currentType=null},zoomFeature:function(t){if(n2.maps.Context.infoWindow.close(),n2.maps.Context.clickEvent){var e,n=n2.maps.Context.clickEvent.feature.getId();n2.maps.Zoom.canBeZoomed(n)&&(n2.maps.Breadcrumb.addItem(n,t),n2.maps.Constants.ZOOM_TYPE_POSTAL_DETAIL===t&&(e=new google.maps.LatLngBounds,n2.maps.Context.clickEvent.feature.getGeometry().forEachLatLng(function(t){e.extend(t)})),n2.maps.Features.loadGeoJsonData(e))}}};